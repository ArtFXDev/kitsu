(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d575b7c4"],{"0024":function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"data-list"},[s("div",{staticStyle:{overflow:"hidden"}},[s("table",{ref:"headerWrapper",staticClass:"datatable"},[s("thead",{staticClass:"datatable-head"},[s("tr",{staticClass:"datatable-row-header"},[s("th",{staticClass:"type"},[t._v(" "+t._s(t.$t("tasks.fields.task_type"))+" ")]),s("th",{staticClass:"status"},[t._v(" "+t._s(t.$t("tasks.fields.task_status"))+" ")]),s("th",{staticClass:"estimation"},[t._v(" "+t._s(t.$t("tasks.fields.estimation").substring(0,3))+". ")]),s("th",{staticClass:"estimation"},[t._v(" "+t._s(t.$t("tasks.fields.duration").substring(0,3))+". ")]),s("th",{staticClass:"duedate"},[t._v(" "+t._s(t.$t("tasks.fields.due_date"))+" ")]),s("th",{staticClass:"assignees"},[t._v(" "+t._s(t.$t("tasks.fields.assignees"))+" ")]),s("th",{staticClass:"end-cell"})])])])]),s("table-info",{attrs:{"is-loading":t.isLoading,"is-error":t.isError}}),t.entries.length>0?s("div",{directives:[{name:"scroll",rawName:"v-scroll",value:t.onBodyScroll,expression:"onBodyScroll"}]},[s("table",{staticClass:"datatable"},[s("tbody",{staticClass:"datatable-body"},t._l(t.sortedEntries,(function(e){return s("tr",{key:"string"===typeof e?e:e.id,class:{selected:t.currentTask&&t.currentTask.id===e,"datatable-row":!0,"datatable-row--selectable":!0},on:{click:function(s){t.selectTask(t.getTask(e))}}},[t.getTaskType(e)?s("task-type-cell",{staticClass:"type",attrs:{"task-type":t.getTaskType(e),"production-id":t.currentProduction.id}}):t._e(),s("td",{staticClass:"status"},[t.getTask(e)?s("validation-tag",{attrs:{task:t.getTask(e),"is-static":!0}}):t._e()],1),s("td",{staticClass:"estimation"},[t._v(" "+t._s(t.getTaskEstimation(e))+" ")]),s("td",{staticClass:"estimation"},[t._v(" "+t._s(t.getTaskDuration(e))+" ")]),s("td",{staticClass:"duedate"},[t._v(" "+t._s(t.getTaskDueDate(e))+" ")]),s("td",{staticClass:"assignees"},[t.isCurrentUserClient||t.isCurrentUserVendor?t._e():s("div",{staticClass:"flexrow"},t._l(t.getAssignees(e),(function(a){return s("div",{key:a,staticClass:"avatar-wrapper"},[s("people-avatar",{key:e+"-"+a,staticClass:"person-avatar flexrow-item",attrs:{person:t.personMap.get(a),size:30,"font-size":15}})],1)})),0)]),s("td",{staticClass:"end-cell"})],1)})),0)])]):t._e()],1)},i=[],n=s("2909"),r=s("5530"),c=(s("4e82"),s("d3b7"),s("ddb0"),s("b0c0"),s("2f62")),o=s("31f2"),d=s("58f5"),l=s("e60b"),u=s("fe13"),h=s("eb8c"),f={name:"entity-task-list",mixins:[o["a"]],components:{TableInfo:l["a"],TaskTypeCell:d["a"],PeopleAvatar:h["a"],ValidationTag:u["a"]},props:{entries:{type:Array,default:function(){return[]}},isLoading:{type:Boolean,default:!1},isError:{type:Boolean,default:!1}},data:function(){return{currentTask:null}},computed:Object(r["a"])(Object(r["a"])({},Object(c["c"])(["currentProduction","getTaskTypePriority","isCurrentUserClient","isCurrentUserVendor","personMap","taskMap","taskTypeMap"])),{},{sortedEntries:function(){var t=this;return Object(n["a"])(this.entries).sort((function(e,s){var a=t.getTask(e),i=t.getTask(s),n=t.taskTypeMap.get(a.task_type_id),r=t.taskTypeMap.get(i.task_type_id),c=t.getTaskTypePriority(a.task_type_id),o=t.getTaskTypePriority(i.task_type_id);return c===o?n.name.localeCompare(r.name):c-o}))}}),methods:Object(r["a"])(Object(r["a"])({},Object(c["b"])([])),{},{onBodyScroll:function(t,e){this.$refs.headerWrapper.style.left="-".concat(e.scrollLeft,"px")},getTask:function(t){return"string"===typeof t?this.taskMap.get(t):t},getTaskDueDate:function(t){var e=this.getTask(t);return e&&e.due_date?e.due_date.substring(0,10):""},getTaskEstimation:function(t){var e=this.getTask(t);return e&&e.estimation?this.formatDuration(e.estimation):""},getTaskDuration:function(t){var e=this.getTask(t);return e&&e.duration?this.formatDuration(e.duration):""},getTaskType:function(t){var e=this.getTask(t);return e?this.taskTypeMap.get(e.task_type_id):null},getAssignees:function(t){var e=this.getTask(t);return e?e.assignees:[]},selectTask:function(t){this.currentTask=t,this.$emit("task-selected",t)}})},p=f,_=(s("eef3"),s("0c7c")),m=Object(_["a"])(p,a,i,!1,null,"2725625c",null);e["a"]=m.exports},"0dd7":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"columns fixed-page asset"},[s("div",{staticClass:"column main-column"},[s("div",{staticClass:"page-header flexrow"},[s("router-link",{staticClass:"flexrow-item has-text-centered back-link",attrs:{to:t.assetsPath}},[s("chevron-left-icon")],1),t.currentAsset?s("entity-thumbnail",{staticClass:"asset-thumbnail flexrow-item",attrs:{entity:t.currentAsset,"with-link":!1}}):t._e(),s("div",{staticClass:"flexrow-item"},[s("page-title",{staticClass:"entity-title",attrs:{text:t.title}})],1),s("div",{staticClass:"flexrow-item"},[t.isCurrentUserManager?s("button-simple",{attrs:{icon:"edit"},on:{click:function(e){t.modals.edit=!0}}}):t._e()],1)],1),s("div",{staticClass:"flexrow infos"},[s("div",{staticClass:"flexrow-item"},[s("page-subtitle",{attrs:{text:t.$t("assets.tasks")}}),s("entity-task-list",{staticClass:"task-list",attrs:{entries:t.currentAsset?t.currentAsset.tasks:[],"is-loading":!t.currentAsset,"is-error":!1},on:{"task-selected":t.onTaskSelected}})],1),s("div",{staticClass:"flexrow-item"},[s("page-subtitle",{attrs:{text:t.$t("main.info")}}),s("div",{staticClass:"table-body"},[t.currentAsset?s("table",{staticClass:"datatable"},[s("tbody",{staticClass:"table-body"},[s("tr",{staticClass:"datatable-row"},[s("td",{staticClass:"field-label"},[t._v(t._s(t.$t("assets.fields.description")))]),s("description-cell",{attrs:{entry:t.currentAsset,full:!0}})],1),t._l(t.assetMetadataDescriptors,(function(e){return s("tr",{key:e.id,staticClass:"datatable-row"},[s("td",{staticClass:"field-label"},[t._v(t._s(e.name))]),s("td",[t._v(" "+t._s(t.currentAsset.data?t.currentAsset.data[e.field_name]:"")+" ")])])}))],2)]):t._e()])],1)]),t.scheduleItems[0].children.length>0?s("div",{staticClass:"infos schedule"},[s("page-subtitle",{staticClass:"schedule-title",attrs:{text:"Schedule"}}),s("div",{staticClass:"wrapper"},[s("schedule",{ref:"schedule-widget",attrs:{"start-date":t.tasksStartDate,"end-date":t.tasksEndDate,hierarchy:t.scheduleItems,"zoom-level":2,height:400,"is-loading":!1,"is-estimation-linked":!0,"hide-root":!0,"with-milestones":!1}})],1)],1):t._e(),s("div",{staticClass:"asset-casted-in"},[s("page-subtitle",{attrs:{text:t.$t("assets.cast_in")}}),t.currentAsset?s("div",[t.currentAsset.castInShotsBySequence&&t.currentAsset.castInShotsBySequence[0].length>0?s("div",t._l(t.currentAsset.castInShotsBySequence,(function(e){return e[0].sequence_name?s("div",{key:e.length>0?e[0].sequence_name:"",staticClass:"sequence-shots"},[s("div",{staticClass:"shot-sequence"},[t._v(" "+t._s(e.length>0?e[0].sequence_name:"")+" ")]),s("div",{staticClass:"shot-list"},t._l(e,(function(e){return s("router-link",{key:e.shot_id,staticClass:"shot-link",attrs:{to:t.shotPath(e)}},[s("entity-thumbnail",{attrs:{entity:e,square:!0,"empty-width":103,"empty-height":103,"with-link":!1}}),s("div",[s("span",[t._v(t._s(e.shot_name))]),e.nb_occurences>1?s("span",[t._v(" ("+t._s(e.nb_occurences)+") ")]):t._e()])],1)})),1)]):t._e()})),0):s("div",[t._v(" "+t._s(t.$t("assets.no_cast_in"))+" ")])]):s("table-info",{attrs:{"is-loading":t.castIn.isLoadin,"is-error":t.castIn.isError}}),t.currentAsset&&t.currentAsset.castingAssetsByType&&t.currentAsset.castingAssetsByType[0].length>0?s("div",[s("page-subtitle",{attrs:{text:"Linked"}}),t.currentAsset.castingAssetsByType&&t.currentAsset.castingAssetsByType[0].length>0?s("div",t._l(t.currentAsset.castingAssetsByType,(function(e){return s("div",{key:e.length>0?e[0].asset_type_name:"",staticClass:"type-assets"},[s("div",{staticClass:"asset-type"},[t._v(" "+t._s(e.length>0?e[0].asset_type_name:"")+" ("+t._s(e.length)+") ")]),s("div",{staticClass:"asset-list"},t._l(e,(function(e){return s("router-link",{key:e.id,staticClass:"asset-link",attrs:{to:{name:"asset",params:{production_id:t.currentProduction.id,asset_id:e.asset_id}}}},[s("entity-thumbnail",{attrs:{entity:e,square:!0,"empty-width":103,"empty-height":103,"with-link":!1}}),s("div",[s("span",[t._v(t._s(e.asset_name))]),e.nb_occurences>1?s("span",[t._v(" ("+t._s(e.nb_occurences)+") ")]):t._e()])],1)})),1)])})),0):t._e()],1):t._e()],1)]),t.currentTask?s("div",{staticClass:"column side-column"},[s("task-info",{attrs:{task:t.currentTask}})],1):t._e(),s("edit-asset-modal",{ref:"edit-asset-modal",attrs:{active:t.modals.edit,"is-loading":t.loading.edit,"is-error":t.errors.edit,"asset-to-edit":t.currentAsset},on:{cancel:function(e){t.modals.edit=!1},confirm:t.confirmEditAsset}})],1)},i=[],n=s("5530"),r=(s("b0c0"),s("2f62")),c=s("f58f"),o=s("31f2"),d=s("0a35"),l=s("de40"),u=s("0fcb"),h=s("813f"),f=s("0024"),p=s("bb21"),_=s("8d07"),m=s("8751"),g=s("d7c7"),k=s("e60b"),y=s("9d94"),b={name:"asset",mixins:[c["a"],o["a"]],components:{ButtonSimple:l["a"],ChevronLeftIcon:d["j"],DescriptionCell:u["a"],EditAssetModal:h["a"],EntityThumbnail:p["a"],EntityTaskList:f["a"],PageSubtitle:m["a"],PageTitle:_["a"],Schedule:g["a"],TableInfo:k["a"],TaskInfo:y["default"]},data:function(){return{currentAsset:null,currentTask:null,castIn:{isLoading:!1,isError:!1},errors:{edit:!1},loading:{edit:!1},modals:{edit:!1}}},mounted:function(){var t=this;this.clearSelectedTasks(),this.currentAsset=this.getCurrentAsset(),this.castIn.isLoading=!0,this.castIn.isError=!1,this.currentAsset?this.loadAssetCastIn(this.currentAsset).then((function(){return t.loadAssetCasting(t.currentAsset)})).then((function(){t.castIn.isLoading=!1})).catch((function(e){t.castIn.isError=!0,console.error(e)})):this.resetData()},computed:Object(n["a"])(Object(n["a"])({},Object(r["c"])(["assetMap","assetMetadataDescriptors","currentEpisode","currentProduction","getTaskTypePriority","isTVShow","isCurrentUserManager","route","taskMap","taskTypeMap","shotId"])),{},{title:function(){return this.currentAsset?"".concat(this.currentAsset.asset_type_name," / ")+"".concat(this.currentAsset.name):"Loading..."},assetThumbnailPath:function(){var t=this.currentAsset.preview_file_id;return"/api/pictures/originals/preview-files/".concat(t,".png")},isPreview:function(){return this.currentAsset&&this.currentAsset.preview_file_id&&this.currentAsset.preview_file_id.length>0},assetsPath:function(){var t={name:"assets",params:{production_id:this.currentProduction.id},query:{search:""}};return this.currentEpisode&&(t.name="episode-assets",t.params.episode_id=this.currentEpisode.id),t}}),methods:Object(n["a"])(Object(n["a"])({},Object(r["b"])(["clearSelectedTasks","editAsset","loadAssets","loadAssetCastIn","loadAssetCasting","loadShots","setCurrentEpisode"])),{},{changeTab:function(t){this.selectedTab=t},getCurrentAsset:function(){return this.assetMap.get(this.route.params.asset_id)||null},onEditClicked:function(){this.modals.edit=!0},confirmEditAsset:function(t){var e=this;t.id=this.currentAsset.id,this.loading.edit=!0,this.errors.edit=!1,this.editAsset(t).then((function(){e.loading.edit=!1,e.modals.edit=!1})).catch((function(t){console.error(t),e.loading.edit=!1,e.errors.edit=!0}))},onTaskSelected:function(t){this.currentTask=t},resetData:function(){var t=this;this.castIn.isLoading=!0,"main"===this.$route.params.episode_id&&this.setCurrentEpisode("main"),this.$nextTick((function(){t.loadAssets().then((function(){return t.currentAsset=t.getCurrentAsset(),t.loadAssetCastIn(t.currentAsset)})).then((function(){return t.loadAssetCasting(t.currentAsset)})).then((function(){t.castIn.isLoading=!1})).catch((function(e){t.castIn.isError=!0,t.castIn.isLoading=!1,console.error(e)}))}))},shotPath:function(t){return{name:t.episode_id?"episode-shot":"shot",params:{production_id:this.currentProduction.id,shot_id:t.shot_id,episode_id:t.episode_id?t.episode_id:void 0}}}}),watch:{currentProduction:function(){this.isTVShow||this.resetData()},currentEpisode:function(){this.isTVShow&&"main"!==this.currentEpisode.id&&this.resetData()}},metaInfo:function(){return{title:"".concat(this.title," - Kitsu")}}},v=b,C=(s("271c"),s("0c7c")),T=Object(C["a"])(v,a,i,!1,null,"3bc10fe8",null);e["default"]=T.exports},"271c":function(t,e,s){"use strict";s("bdf1")},bdf1:function(t,e,s){},c3ab:function(t,e,s){},eef3:function(t,e,s){"use strict";s("c3ab")},f58f:function(t,e,s){"use strict";s.d(e,"a",(function(){return c}));var a=s("5530"),i=(s("4e82"),s("4de4"),s("d81d"),s("b0c0"),s("3657")),n=s("c1df"),r=s.n(n),c={created:function(){},mounted:function(){},beforeDestroy:function(){},computed:{currentTasks:function(){var t=this,e=this.currentAsset||this.currentShot;return e?e.tasks.map((function(e){return t.taskMap.get(e)})).filter((function(t){return t})).sort((function(e,s){var a=t.getTaskTypePriority(e.task_type_id),i=t.getTaskTypePriority(s.task_type_id);return a>i})):[]},tasksStartDate:function(){return this.scheduleItems.length>0&&this.scheduleItems[0].children.length>0?Object(i["l"])(this.scheduleItems[0].children):r()()},tasksEndDate:function(){return this.scheduleItems.length>0&&this.scheduleItems[0].children.length>0?Object(i["m"])(this.scheduleItems[0].children):r()().add(30,"days")},scheduleItems:function(){var t=this,e=0,s={avatar:!1,id:"root",name:"Tasks",color:"#888",for_shots:!1,priority:1,expanded:!0,loading:!1,children:[],editable:!1},n=r()(),c=this.currentTasks.map((function(r){var c,o=t.formatDuration(r.estimation),d=n.clone();if(!r.start_date&&!r.real_start_date&&!r.due_date&&!r.end_date)return null;r.start_date?d=Object(i["s"])(r.start_date):r.real_start_date&&(d=Object(i["s"])(r.real_start_date)),r.due_date?c=Object(i["s"])(r.due_date):r.end_date?c=Object(i["s"])(r.end_date):r.estimation&&(c=d.clone().add(o,"days")),c&&!c.isBefore(d)||(c=d.clone().add(1,"days")),o&&(e+=r.estimation);var l=t.taskTypeMap.get(r.task_type_id);return Object(a["a"])(Object(a["a"])({},r),{},{name:l.name,startDate:d,endDate:c,expanded:!1,loading:!1,man_days:o,editable:!1,unresizable:!1,parentElement:s,color:l.color,children:[]})})).filter((function(t){return null!==t})),o=r()(),d=r()().add("days",1);return c.length>0&&(o=Object(i["l"])(c),d=Object(i["m"])(c)),Object.assign(s,{children:c,startDate:o,endDate:d,man_days:e}),[s]}},methods:{}}}}]);
//# sourceMappingURL=chunk-d575b7c4.2f431832.js.map