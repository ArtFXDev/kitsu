(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6f4aea9a"],{"236e":function(e,t,s){"use strict";s("b34d")},a01b:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{ref:"page",staticClass:"columns fixed-page"},[s("div",{staticClass:"column main-column"},[s("div",{staticClass:"person page"},[s("div",{ref:"header",staticClass:"flexrow page-header"},[e.person?s("div",{staticClass:"flexrow-item"},[s("people-avatar",{attrs:{person:e.person,size:80,"font-size":30,"is-text":!1}})],1):e._e(),s("div",{staticClass:"flexrow-item"},[s("page-title",{attrs:{text:e.person?e.person.name:""}})],1)]),s("div",{ref:"tabs",staticClass:"task-tabs tabs"},[e.person?s("ul",[s("li",{class:{"is-active":e.isActiveTab("todos")}},[s("router-link",{attrs:{to:{name:"person",params:{person_id:e.person.id}}}},[e._v(" "+e._s(e.$t("tasks.current"))+" ")])],1),s("li",{class:{"is-active":e.isActiveTab("done")}},[s("router-link",{attrs:{to:{name:"person-tab",params:{tab:"done",person_id:e.person.id}}}},[e._v(" "+e._s(e.$t("tasks.done"))+" ("+e._s(e.displayedPersonDoneTasks.length)+") ")])],1),e.isCurrentUserManager?s("li",{class:{"is-active":e.isActiveTab("timesheets")}},[s("router-link",{attrs:{to:{name:"person-tab",params:{tab:"timesheets",person_id:e.person.id}}}},[e._v(" "+e._s(e.$t("timesheets.title"))+" ")])],1):e._e(),s("li",{class:{"is-active":e.isActiveTab("schedule")}},[s("router-link",{attrs:{to:{name:"person-tab",params:{tab:"schedule",person_id:e.person.id}}}},[e._v(" "+e._s(e.$t("schedule.title"))+" ")])],1)]):e._e()]),s("div",{ref:"search",staticClass:"flexrow"},[e.isActiveTab("done")?e._e():s("search-field",{ref:"person-tasks-search-field",class:{"search-field":!0,"flexrow-item":!0},attrs:{"can-save":!0},on:{change:e.onSearchChange,save:e.saveSearchQuery}}),s("span",{staticClass:"filler"}),s("combobox",{staticClass:"flexrow-item",attrs:{label:e.$t("main.sorted_by"),options:e.sortOptions,"locale-key-prefix":"tasks.fields."},model:{value:e.currentSort,callback:function(t){e.currentSort=t},expression:"currentSort"}})],1),s("div",{ref:"query"},[s("div",{directives:[{name:"show",rawName:"v-show",value:e.isActiveTab("todos")||e.isActiveTab("timesheets"),expression:"isActiveTab('todos') || isActiveTab('timesheets')"}],staticClass:"query-list"},[s("search-query-list",{attrs:{queries:e.personTaskSearchQueries},on:{"change-search":e.changeSearch,"remove-search":e.removeSearchQuery}})],1)]),e.isActiveTab("todos")?s("todos-list",{ref:"task-list",attrs:{tasks:e.sortedTasks,"is-loading":e.isTasksLoading,"is-error":e.isTasksLoadingError,"selection-grid":e.personTaskSelectionGrid},on:{scroll:e.setPersonTasksScrollPosition}}):e._e(),e.isActiveTab("done")?s("todos-list",{ref:"done-list",attrs:{tasks:e.displayedPersonDoneTasks,"is-loading":e.isTasksLoading,"is-error":e.isTasksLoadingError,done:!0,selectionGrid:e.personTaskSelectionGrid}}):e._e(),e.isActiveTab("timesheets")?s("timesheet-list",{attrs:{tasks:e.loggablePersonTasks,"done-tasks":e.loggableDoneTasks,"is-loading":e.isTasksLoading,"is-error":e.isTasksLoadingError,"time-spent-map":e.personTimeSpentMap,"time-spent-total":e.personTimeSpentTotal,"hide-done":e.personTasksSearchText.length>0},on:{"date-changed":e.onDateChanged,"time-spent-change":e.onTimeSpentChange,"set-day-off":e.onSetDayOff,"unset-day-off":e.onUnsetDayOff}}):e._e(),e.isActiveTab("schedule")?s("div",[e.scheduleItems.length>0?s("schedule",{ref:"schedule-widget",attrs:{"start-date":e.tasksStartDate,"end-date":e.tasksEndDate,hierarchy:e.scheduleItems,"zoom-level":2,height:e.scheduleHeight,"is-loading":e.isTasksLoading,"is-estimation-linked":!0,"with-milestones":!1}}):s("div",{staticClass:"has-text-centered"},[e._v(" There is no tasks scheduled for current person. ")])],1):e._e()],1)]),1===e.nbSelectedTasks?s("div",{staticClass:"column side-column"},[s("task-info",{attrs:{task:e.selectedTasks.values().next().value}})],1):e._e()])},i=[],n=s("2909"),r=s("5530"),o=(s("d81d"),s("4de4"),s("4e82"),s("159b"),s("99af"),s("4ec9"),s("d3b7"),s("3ca3"),s("ddb0"),s("a630"),s("ac1f"),s("841c"),s("b0c0"),s("caad"),s("7f45")),c=s.n(o),d=s("ceca"),l=s.n(d),h=s("2f62"),u=s("31f2"),f=s("7930"),p=s("3657"),m=s("992f"),T=s("8d07"),k=s("eb8c"),v=s("d7c7"),b=s("4d04"),g=s("55ce"),_=s("b11e"),S=s("e739"),y=s("9d94"),D={name:"person",mixins:[u["a"]],components:{Combobox:m["a"],PageTitle:T["a"],PeopleAvatar:k["a"],Schedule:v["a"],SearchField:b["a"],SearchQueryList:g["a"],TaskInfo:y["default"],TodosList:S["a"],TimesheetList:_["a"]},data:function(){return{activeTab:"todos",currentSort:"entity_name",isTasksLoading:!1,isTasksLoadingError:!1,person:null,scheduleHeight:0,selectedDate:c()().format("YYYY-MM-DD"),sortOptions:["entity_name","priority","task_status_short_name","estimation","due_date","last_comment_date"].map((function(e){return{label:e,value:e}}))}},mounted:function(){var e=this;this.updateActiveTab(),this.personTasksSearchText.length>0&&this.searchField.setValue(this.personTasksSearchText),setTimeout((function(){e.searchField&&e.searchField.focus()}),100),this.loadPerson(this.$route.params.person_id),window.addEventListener("resize",this.resetScheduleHeight)},afterDestroy:function(){window.removeEventListener("resize",this.resetScheduleHeight),this.$store.commit("LOAD_PERSON_TASKS_END",{tasks:[],userFilters:{},taskTypeMap:this.taskTypeMap})},computed:Object(r["a"])(Object(r["a"])({},Object(h["c"])(["displayedPersonTasks","displayedPersonDoneTasks","isCurrentUserManager","nbSelectedTasks","personMap","personTasksScrollPosition","personTasksSearchText","personTaskSearchQueries","personTaskSelectionGrid","personTimeSpentMap","personTimeSpentTotal","productionMap","selectedTasks","taskTypeMap"])),{},{loggablePersonTasks:function(){var e=this;return this.displayedPersonTasks.filter((function(t){return e.taskTypeMap.get(t.task_type_id).allow_timelog}))},loggableDoneTasks:function(){var e=this;return this.displayedPersonDoneTasks.filter((function(t){return e.taskTypeMap.get(t.task_type_id).allow_timelog}))},searchField:function(){return this.$refs["person-tasks-search-field"]},taskList:function(){return this.$refs["task-list"]},haveDoneList:function(){return this.$refs["done-list"]},sortedTasks:function(){var e="entity_name"===this.currentSort,t=Object(n["a"])(this.displayedPersonTasks);return e?t.sort(l()("project_name").thenBy("task_type_name").thenBy("full_entity_name")):t.sort(l()(this.currentSort,-1).thenBy("project_name").thenBy("task_type_name").thenBy("entity_name"))},tasksStartDate:function(){return this.scheduleItems.length>0?Object(p["l"])(this.scheduleTasks):c()()},tasksEndDate:function(){return this.scheduleItems.length>0?Object(p["m"])(this.scheduleTasks):c()().add(15,"days")},scheduleTasks:function(){var e=[];return this.scheduleItems.forEach((function(t){e=e.concat(t.children)})),e},scheduleItems:function(){var e=this,t=new Map;this.sortedTasks.forEach((function(s){if(!t.get(s.project_id)){var a=e.productionMap.get(s.project_id),i=e.buildProjectScheduleItem(a);t.set(s.project_id,i)}var n=t.get(s.project_id),r=e.buildTaskScheduleItem(n,s);r&&n.children.push(r)}));var s=Array.from(t.values());return s.forEach((function(t){var s=c()(),a=c()().add("days",1),i=0;t.children.length>0&&(s=Object(p["l"])(t.children),a=Object(p["m"])(t.children)),t.children.forEach((function(t){var s=e.formatDuration(t.estimation);s&&(i+=t.estimation)})),Object.assign(t,{startDate:s,endDate:a,man_days:i})})),s}}),methods:Object(r["a"])(Object(r["a"])({},Object(h["b"])(["loadPersonTasks","setPersonTasksSearch","savePersonTasksSearch","removePersonTasksSearch","setDayOff","setPersonTasksScrollPosition","setTimeSpent","unsetDayOff"])),{},{resetScheduleHeight:function(){var e=this;this.$nextTick((function(){if(e.isActiveTab("schedule")){var t=e.$refs.page.offsetHeight,s=e.$refs.header.offsetHeight,a=e.$refs.tabs.offsetHeight,i=e.$refs.search.offsetHeight,n=e.$refs.query.offsetHeight;e.scheduleHeight=t-s-a-i-n,e.$refs["schedule-widget"]&&e.$refs["schedule-widget"].resetScheduleSize()}}))},buildProjectScheduleItem:function(e){return Object(r["a"])(Object(r["a"])({},e),{},{avatar:!0,color:f["a"].fromString(e.name,!0),for_shots:!1,priority:1,expanded:!0,loading:!1,children:[],editable:!1})},buildTaskScheduleItem:function(e,t){var s,a=c()();if(!t.start_date&&!t.real_start_date&&!t.due_date&&!t.end_date)return null;t.start_date?a=Object(p["t"])(t.start_date):t.real_start_date&&(a=Object(p["t"])(t.real_start_date));var i=this.formatDuration(t.estimation);t.due_date?s=Object(p["t"])(t.due_date):t.end_date?s=Object(p["t"])(t.end_date):t.estimation&&(s=a.clone().add(i,"days")),s&&!s.isBefore(a)||(s=a.clone().add(1,"days"));var n=this.taskTypeMap.get(t.task_type_id);return Object(r["a"])(Object(r["a"])({},t),{},{name:t.full_entity_name,startDate:a,endDate:s,expanded:!1,loading:!1,man_days:i,editable:!1,unresizable:!1,parentElement:e,color:n.color,children:[]})},isActiveTab:function(e){return this.activeTab===e},selectTab:function(e){var t=this;this.activeTab=e,this.isActiveTab("todos")&&setTimeout((function(){t.searchField&&t.searchField.focus()}),100)},onSearchChange:function(e){this.setPersonTasksSearch(e)},loadPerson:function(e){var t=this;this.person=this.personMap.get(e),this.isTasksLoading=!0,this.loadPersonTasks({personId:this.person.id,date:this.selectedDate,callback:function(e){e&&console.error(e),t.isTasksLoading=!1,t.isTasksLoadingError=!1,setTimeout((function(){t.taskList&&t.$nextTick((function(){t.taskList.setScrollPosition(t.personTasksScrollPosition)})),t.resizeHeaders()}),0)}})},resizeHeaders:function(){var e=this;this.$nextTick((function(){e.taskList&&e.taskList.resizeHeaders(),e.haveDoneList&&e.haveDoneList.resizeHeaders()}))},selectCurrent:function(){var e=this;this.activeTab="current",setTimeout((function(){e.$refs["person-tasks-search-field"].focus()}),100)},selectDone:function(){this.activeTab="done"},changeSearch:function(e){this.$refs["person-tasks-search-field"].setValue(e.search_query),this.$refs["person-tasks-search-field"].$emit("change",e.search_query)},saveSearchQuery:function(e){this.savePersonTasksSearch(e).then((function(){})).catch((function(e){e&&console.error(e)}))},removeSearchQuery:function(e){this.removePersonTasksSearch(e).then((function(){})).catch((function(e){e&&console.error(e)}))},updateActiveTab:function(){var e=["done","timesheets","schedule"];e.includes(this.$route.params.tab)?this.activeTab=this.$route.params.tab:this.activeTab="todos"},onTimeSpentChange:function(e){e.personId=this.person.id,e.date=this.selectedDate,this.setTimeSpent(e)},onDateChanged:function(e){this.selectedDate=c()(e).format("YYYY-MM-DD"),this.loadPerson(this.person.id)},onSetDayOff:function(){var e={personId:this.person.id,date:this.selectedDate};this.setDayOff(e)},onUnsetDayOff:function(){var e={personId:this.person.id,date:this.selectedDate};this.unsetDayOff(e)}}),metaInfo:function(){return{title:this.person?"".concat(this.person.name," - Kitsu"):"... - Kitsu"}},watch:{$route:function(){var e=this.$route.params.person_id;this.updateActiveTab(),this.person.id!==e&&this.loadPerson()},activeTab:function(){this.resetScheduleHeight()}}},O=D,P=(s("236e"),s("0c7c")),j=Object(P["a"])(O,a,i,!1,null,"571d6a9b",null);t["default"]=j.exports},b34d:function(e,t,s){}}]);
//# sourceMappingURL=chunk-6f4aea9a.2fccad4c.js.map